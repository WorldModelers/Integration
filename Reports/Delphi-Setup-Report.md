# Delphi Analysis

* Analysis Date: 10/25/2018
* Software Release: Delphi v3.0.0
* URL: [https://github.com/ml4ai/delphi](https://github.com/ml4ai/delphi)

Brandon tested with:

* System: Ubuntu 16.04
* Scala Version: 2.12.7
* Java Version: openjdk 1.8.0_181
* Java Runtime Environment: OpenJDK Runtime Environment (build 1.8.0_181-8u181-b13-0ubuntu0.16.04.1-b13)
* Python 3.7.0

## Contents
* [General Findings](#general-findings)
* [Documentation](#documentation)
* [Installation](#installation)
* [Running Delphi](#running-delph)
* [Integration](#integration)

## General Findings
Similar to INDRA, Delphi is easy to install but is still somewhat complex to configure and get running. It has requirements that are not explicitly installed along with it (in its `setup.py` file), namely INDRA as well as other Python packages. 

Furthermore, it requires a data download and environment variable configuration, which is not typical of most Python libraries. 

Delphi documentation is focused on function; the most useful components of the documentation are found in example Jupyter Notebooks. Delphi example code could perform reading with Eidos, assembly with INDRA, and modeling with Delphi but do not do this. Demonstrating this entire pipeline is an area for improvement.

Data standards for parameterization data and concepts are not explicitly described, which could lead to "brittleness" of the software when attempting to use it for different regions or use cases.

## Documentation
Delphi has both a [Read the Docs instance (RTD)](https://delphi.readthedocs.io/en/latest/index.html) as well as basic install and usage information on a [Github README](https://github.com/ml4ai/delphi/blob/master/README.md). 

The documentation does not describe in detail how data sources for parameterization must be formatted nor does it describe how data used to map concepts to indicators must be formatted. In the example notebook, concepts are pulled from a sample of [UN FAO data](http://vision.cs.arizona.edu/adarsh/export/demos/data/concept_to_indicator_mapping.txt). Parameterization [data for South Sudan](http://vision.cs.arizona.edu/adarsh/export/demos/data/south_sudan_data.csv) is used but its provenance is not explicitly cited nor its format described.

## Installation:
First, the steps for installing Eidos and INDRA were run ([see steps here](https://github.com/WorldModelers/Integration/blob/master/Reports/INDRA-Setup-Report.md#installation)). Then the following were run:

```
git clone https://github.com/ml4ai/delphi
cd delphi
python setup.py install

# Get Delphi Data
sudo apt-get install unzip
wget https://s3.amazonaws.com/world-modelers/data/delphi_data.zip
unzip delphi_data.zip

# Set DELPHI_DATA environment variable
echo "export DELPHI_DATA=/home/ubuntu/data/ export PATH=$DELPHI_DATA/bin:$PATH" >> /home/ubuntu/.bashrc
source ~/.bashrc

pip install fuzzywuzzy seaborn
```

Note that `pipenv` was not used (per the Delphi README) since `conda` was already used to establish an environment for INDRA (and Delphi). If 

## Running Delphi
The [Delphi Demo Notebook](https://github.com/ml4ai/delphi/blob/master/notebooks/Delphi-Demo-Notebook.ipynb) was run through successfully without any major issues. 

## Integration
Delphi's core input is a set of INDRA statements such as:

```
[Influence(South Sudanese(), flee home()),
 Influence(exchange South Sudanese Pound SSP dollar(), halve ssp usd ssp usd(negative)),
 Influence(Countries(), export tax(positive)),
 Influence(proximity county conflict(), conflict()),
 Influence(cent home be report have be damage destroy village village Unity.29 Civilians(), leave item blanket mat mosquito net()),
 ...etc
```
 
These are converted to a Delphi Model (an abstraction of a NetworkX graph). The model may then be modified and have indicators mapped to the concepts (nodes) in the graph.
 
Prior to executing the model, there is apparently a key step which is not clearly documented: [inferring the transition model](https://delphi.readthedocs.io/en/latest/_modules/delphi/AnalysisGraph.html#AnalysisGraph.infer_transition_model). This step requires "adjective" data; data generated by Mechanical Turkers regarding the meaning (magnitue impact) of a given adjective. The example file used by UAZ is a [TSV called adjectiveData.tsv](http://vision.cs.arizona.edu/adarsh/export/demos/data/adjectiveData.tsv). If no argument is provided for adjective data when inferring the transition model, then [default data is used](https://github.com/ml4ai/delphi/blob/master/delphi/paths.py#L7).

Though there are some methods to inspect your model, none seem to present all the model data. To achieve this, you can use the networkx API. You can retrieve the node names with `G.nodes()` (where `G` is your Model Graph). Then, you may access a specific node's data with an indexer. For example, if the node is called `'market'` you can use `G['market']` to return that node's information:

```
AtlasView({'livelihood': {'InfluenceStatements': [Influence(price(negative), Domestic agricultural
production(negative))], 'ConditionalProbability': <scipy.stats.kde.gaussian_kde object at 0x7f5992ac12b0>, 'betas': array([ 1.65123871e-01,  4.00682920e+00,  1.09307027e+00,  3.18524748e+01,
       -1.75574465e+00,  6.46390333e-02,  5.01271907e-01,  9.02199192e-01,
...etc
```

### Model Execution
The primary interface for executing a model seems to be using the [CLI tool](https://github.com/ml4ai/delphi#execute-model). The execution output is in CSV format. However, model execution via the API is not clearly documented.